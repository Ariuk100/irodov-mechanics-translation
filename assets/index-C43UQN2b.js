(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function s(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(t){if(t.ep)return;t.ep=!0;const a=s(t);fetch(t.href,a)}})();let m=null,w=null;const L=document.querySelector("#toc"),$=document.querySelector("#book-content"),k=document.querySelector("#chapter-title"),v=document.querySelector("#sidebar"),T=document.querySelector("#sidebar-toggle");async function x(){try{localStorage.getItem("sidebarCollapsed")==="true"&&v.classList.add("collapsed"),T.addEventListener("click",()=>{v.classList.toggle("collapsed"),window.innerWidth<=768&&v.classList.toggle("active"),localStorage.setItem("sidebarCollapsed",v.classList.contains("collapsed"))});const o=document.getElementById("collapse-all-btn");if(o&&o.addEventListener("click",t=>{t.stopPropagation(),L.querySelectorAll(".expanded").forEach(d=>d.classList.remove("expanded"))}),m=await(await fetch(`/irodov-mechanics-translation/data/library.json?v=${Date.now()}`)).json(),M(),m.books&&m.books.length>0){const t=m.books[0];t.chapters.length>0&&C(t,t.chapters[0].id)}}catch(e){console.error("Failed to initialize app:",e),$&&($.innerHTML='<p class="error">Failed to load content. Please check console.</p>')}}function M(){L&&(L.innerHTML="",m.books&&m.books.forEach(e=>{const o=document.createElement("div");o.className="book-group";const s=document.createElement("div");s.className="book-header";const n='<svg class="book-icon" viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>';s.innerHTML=`${n} <h2 class="book-title-text">${e.title}</h2>`,s.onclick=()=>{o.classList.toggle("expanded")},o.appendChild(s);const t=document.createElement("div");t.className="book-chapters",e.chapters.forEach((a,d)=>{const c=document.createElement("div");c.className="sidebar-item chapter-link",c.dataset.id=a.id;const l=`${d+1}.`,g=a.title,f=document.createElement("div");if(f.className="chapter-header",f.innerHTML=`<h3><span class="ch-num">${l}</span> <span>${g}</span></h3>`,f.onclick=h=>{const r=c.classList.contains("expanded");t.querySelectorAll(".sidebar-item").forEach(p=>p.classList.remove("expanded")),r||c.classList.add("expanded")},c.appendChild(f),a.sections){const h=document.createElement("ul");h.className="chapter-sections",a.sections.forEach(r=>{const p=document.createElement("li");p.className="section-link",p.dataset.id=r.id;const u=r.title.match(/^(§\s*\d+\.\d+\.?)\s*(.*)$/),i=u?u[1]:r.id.includes("problems")?"?":"",E=u?u[2]:r.title;p.innerHTML=`<span class="sec-num">${i}</span><span class="sec-title">${E}</span>`,p.onclick=S=>{S.stopPropagation(),C(e,a.id,r.id),window.innerWidth<=768&&v.classList.remove("active")},h.appendChild(p)}),c.appendChild(h)}t.appendChild(c)}),o.appendChild(t),L.appendChild(o),m.books.indexOf(e)===0&&o.classList.add("expanded")}))}async function C(e,o,s=null){try{const n=e.chapters.find(l=>l.id===o);if(!n)return;let t=null;const a="/irodov-mechanics-translation/";if(n.folder&&s){const l=n.sections.find(g=>g.id===s);l&&l.file&&(t=`${a}data/${n.folder}/${l.file}`)}else if(n.file)t=`${a}data/chapters/${n.file}`;else if(n.folder&&!s&&n.sections.length>0){const l=n.sections[0];t=`${a}data/${n.folder}/${l.file}`,s=l.id}if(!t){console.warn("No file content mapped for this section."),s&&alert("Энэ хэсгийн агуулга одоогоор бэлэн болоогүй байна.");return}document.getElementById("book-content").className="";const c=await(await fetch(t)).json();w={...n,...c},H(c),N(o,s),setTimeout(()=>{window.scrollTo({top:0,behavior:"smooth"}),window.MathJax&&window.MathJax.typesetPromise()},100)}catch(n){console.error("Failed to load chapter:",n)}}function N(e,o){document.querySelectorAll(".section-link").forEach(n=>n.classList.remove("active")),document.querySelectorAll(".sidebar-item").forEach(n=>n.classList.remove("active-chapter"));const s=document.querySelector(`.sidebar-item[data-id="${e}"]`);if(s&&(s.classList.add("active-chapter"),s.classList.add("expanded")),o){const n=s?s.querySelector(`.section-link[data-id="${o}"]`):null;n&&n.classList.add("active")}}function H(e){$&&(k&&(k.textContent=e.title),$.innerHTML="",e.body.forEach(o=>{const s=y(o);s&&$.appendChild(s)}))}function y(e){switch(e.type){case"text":const o=document.createElement("p");return(e.value.includes("Бодолт")||e.value.trim().startsWith("<b>Бодолт")||e.value.includes("Шийдэл")||e.value.trim().startsWith("<b>Шийдэл"))&&(o.className="solution-text"),o.innerHTML=b(e.value),o;case"header":const s=document.createElement("h2");return e.id&&(s.id=e.id),s.textContent=e.value,s;case"note":const n=document.createElement("div");return n.className="note-box",n.innerHTML=b(e.value),n;case"problem":const t=document.createElement("div");t.className="problem-container";let a=`<div class="problem-header"><strong>${e.number}. ${e.title}</strong></div>`;if(a+=`<div class="problem-statement">${b(e.statement)}</div>`,e.image){const u="/irodov-mechanics-translation/";let i=e.image.src;i.startsWith("/")&&(i=i.substring(1)),i.startsWith("images/")&&(i=i.substring(7));const E=`${u}images/${i}`;a+=`
          <div class="image-container">
            <img src="${E}" alt="${e.image.caption||""}">
            ${e.image.caption?`<p class="caption">${e.image.caption}</p>`:""}
          </div>
        `}return e.solution&&(a+=`<div class="problem-solution"><strong>Бодолт:</strong> ${b(e.solution)}</div>`),t.innerHTML=a,t;case"section":const d=document.createElement("section");return d.id=e.id,d.innerHTML=`<h2>${e.title}</h2>`,e.body.forEach(u=>{const i=y(u);i&&d.appendChild(i)}),d;case"subsection":const c=document.createElement("div");return c.className="subsection",c.innerHTML=`<h3>${e.title}</h3>`,e.body.forEach(u=>{const i=y(u);i&&c.appendChild(i)}),c;case"equation":const l=document.createElement("div");l.className="equation-wrapper";const g=e.tag?`<span class="equation-tag">(${e.tag})</span>`:"";return l.innerHTML=`\\[ ${e.value} \\] ${g}`,l;case"image":const f=document.createElement("div");f.className="image-container";const h="/irodov-mechanics-translation/";let r=e.src;r.startsWith("/")&&(r=r.substring(1)),r.startsWith("images/")&&(r=r.substring(7));const p=`${h}images/${r}`;return f.innerHTML=`
        <img src="${p}" alt="${e.caption||""}">
        ${e.caption?`<p class="caption">${e.caption}</p>`:""}
      `,f;default:return null}}function b(e){return e?e.replace(/\$\$(.+?)\$\$/gs,(s,n)=>`\\[${n}\\]`).replace(/\$([^$]+)\$/g,(s,n)=>`\\(${n.trim()}\\)`):""}x();
